define(function(){var a="";$("body").on("click",".js-tip-off",function(){var c=$(this),h=c.data("type"),j=c.data("uid"),y=c.data("id"),b="";return isLogin?(a="//www.imooc.com/discovery/"+c.parents(".feed-list").data("id"),$(".js-tipoff-block").removeClass("cur"),$(".js-tipoff-box").removeClass("cur"),b=$(this).parents(".moco-modal-dialog")[0]?"cur":"",$(".js-tipoff-typebox").find(".tipoff-loading").show(),$(".js-tipoff-block").addClass(b).show(),$(".js-tipoff-box").addClass(b).show(),$.ajax({url:"/service/reporttypes",type:"POST",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(a){if(0==a.status){var c=a.data,h=$(".js-tipoff-typebox"),j="";$.each(c,function(i){j+='<div class="item l">                                    <i class="l icon-checkbox_o js-tipoff-select" data-type="'+c[i].id+'"></i>                                    <p class="l">'+c[i].name+"</p>                                </div>"}),h.find(".tipoff-loading").hide(),h.append(j)}else $.prompt(a.msg,{icon:"error"}),v=0},error:function(){$.prompt("举报接口异常！",{icon:"error"}),v=0},complete:function(){v=0}}),void $(".js-tipoff-submit").attr({"data-type":h,"data-uid":j,"data-id":y})):void $("#js-signin-btn").click()}),$(".js-tipoff-typebox").on("click",".js-tipoff-select",function(){var a=$(this),c=a.data("type"),v=$(".tipoff-type-box").find(".js-tipoff-select"),h=function(a){a.hasClass("on")?(a.removeClass("on icon-checkbox"),$(".js-tipoff-submit").attr("data-tipofftype","")):($.each(v,function(i,a){$(a).removeClass("icon-checkbox").removeClass("on")}),a.addClass("icon-checkbox on"),$(".js-tipoff-submit").attr("data-tipofftype",c))};h(a)});var c=function(){$(".js-tipoff-block").hide(),$(".js-tipoff-box").hide();var a='<div class="tipoff-loading">                        <div class="bounce1"></div>                        <div class="bounce2"></div>                        <div class="bounce3"></div>                    </div>';$(".js-tipoff-typebox").html(a),$(".js-tipoff-desc").val(""),$(".tipoff-text").find(".js-tipoff-text").html("0").css("color","#93999F");var c=$(".tipoff-type-box").find(".js-tipoff-select");$.each(c,function(i,a){$(a).removeClass("icon-checkbox").removeClass("on")}),$(".js-tipoff-submit").attr({"data-type":"","data-uid":"","data-id":"","data-tipofftype":""})};$(".js-tipoff-close").on("click",function(){c()}),$(".js-tipoff-desc").keyup(function(){var a=$(this),c=$(".tipoff-text").find(".js-tipoff-text"),v=$.trim(a.val().replace(/[\r\n]/g,"")).length;v>150?c.html(v).css("color","#f01414"):c.html(v).css("color","#93999f")});var v=0;$(".js-tipoff-submit").on("click",function(){var h=$(this),j=a,y=h.attr("data-uid"),b=h.attr("data-type"),g=h.attr("data-id"),k=h.attr("data-tipofftype"),C=$.trim($(".js-tipoff-desc").val().replace(/[\r\n]/g,""));if(v)return void $.prompt("操作频繁，请稍后",{icon:"error"});if("undefined"==typeof k||""==k)return void $.prompt("请选择举报类型！",{icon:"error"});if(C.length>150)return void $.prompt("举报理由字数超限，请重新输入!",{icon:"error"});var w={report_type:k,page_url:j,reported_uid:y,reported_type:b,reported_type_id:g};0!=C.length&&(w.report_desc=C),v=1,$.ajax({url:"/service/report",data:w,type:"POST",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(a){0==a.status?($.prompt(a.msg,{icon:"success"}),v=0,c()):-110==a.status?($.prompt(a.msg,{icon:"error"}),c(),v=0):-11==a.status?($.prompt(a.msg,{icon:"error"}),window.location.reload()):($.prompt(a.msg,{icon:"error"}),v=0)},error:function(){$.prompt("接口异常！",{icon:"error"}),v=0},complete:function(){v=0}})})});