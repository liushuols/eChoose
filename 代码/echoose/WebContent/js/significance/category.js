define(function(require){require("/static/lib/layer/1.6.0/layer.min.js"),require("/static/lib/layer/1.6.0/skin/layer.css");var a={loadListUser:function(){if("undefined"!=typeof uidArr&&uidArr.length>0){var c,g=uidArr.join(",");$.ajax({url:"/u/getuserinfo?uid="+g,type:"post",dataType:"json",success:function(g){var g;0===g.result&&(c=g.data,a.displayList(c,OP_CONFIG.module))}})}},displayList:function(c){for(var g=$(".left-info"),h=0,v=g.length;v>h;h++)for(var i=0,b=c.length;b>i;i++)g.eq(h).attr("data-fuid")==c[i].uid&&g.eq(h).prepend(a.getUser(c[i]))},getUser:function(a){function c(a,c,g){var h="";return"2"==g&&(h+='<i class="teacher r" title="慕课网讲师"></i>'),a&&(h+='<i class="great r" title="认证作者"></i>'),c&&(h+='<i class="ismooc r" title="慕星人"></i>'),h}return['<a href="/u/',a.uid,'/articles" class="user-card"  target="_blank" >',"<img src=",a.img,' width="24" height="24">',a.nickname,c(a.is_author,a.is_mustar,a.user_type),"</a>"].join("")},unLogin:function(){return OP_CONFIG.userInfo?void 0:void seajs.use("login_sns",function(a){a.init()})},changeSwitch:function(a){var c;a.hasClass("on")?(a.removeClass("on"),c=0):(a.addClass("on"),c=1),$.ajax({url:"/article/setfilter",type:"post",data:{filter:c},dataType:"json"}).done(function(){location=location})},openTagPop:function(){$(".tag-item li").removeClass("active"),$(".tag-item li").eq(0).addClass("active"),$(".tag-item-right .sub").addClass("hide"),$(".tag-item-right .sub").eq(0).removeClass("hide"),$(".tag-item-right .sub").eq(0).css("display","block"),$(".js-tagpop-block").fadeIn(200),$("#tag-pop").fadeIn(200)},closeTagPop:function(){$("#tag-pop").hide(),$(".js-tagpop-block").hide(),$(".tag-item-right .sub").addClass("hide"),$(".tag-item-right .sub").css("display","none"),$(".tag-item-right").empty().html($(".js-origin-right-data").html()),$(".atag-box").empty().html($(".js-origin-data").html())},tabTagItem:function(a){a.addClass("active").siblings().removeClass("active"),$(".tag-item-right .sub").hide().eq(a.index()).show()},addTagList:function(a){var c,g,h,v;a.addClass("active"),g=a.data("tagid"),h=a.data("src"),v=a.data("name"),c=[],$(".tag-item-right li").each(function(){$(this).data("tagid")==g&&$(this).addClass("active")}),$(".atag-box li",document).each(function(){c.push($(this).data("tid"))});var b=c.indexOf(g);if("-1"!=b)return void $.prompt("标签已存在，请关注其他感兴趣标签！",{icon:"error"});var y="";y+="<li data-tid="+g+' class="js-addnew"><img src="'+h+'" alt=""><span>'+v+'</span><i class="js-remove-list imv2-close"></i></li>',$(".atag-box p").addClass("hide"),$(".atag-box .add-tag-item").removeClass("hide"),$(".atag-box .add-tag-item").append(y)},removeTagList:function(a){$(".tag-item-right li").each(function(){a.closest("li").data("tid")==$(this).data("tagid")&&$(this).removeClass("active")}),a.closest("li").remove(),0==$(".atag-box li").length&&($(".atag-box p").removeClass("hide"),$(".atag-box .add-tag-item").addClass("hide"),$(".atag-box").html('<p>点击左边感兴趣的标签<br/>添加到关注</p><ul class="add-tag-item hide"></ul>'))},switchPop:function(a){a.hasClass("on")?a.removeClass("on"):a.addClass("on")},saveTagPop:function(){var a,c;a=[],$(".atag-box li",document).each(function(){a.push($(this).data("tid"))});var g=$(".js-sub-switch").hasClass("on")?"12":"11";c={del:1,filter:g,tagIds:a.join(",")},$.ajax({url:"/article/followtag ",data:c,type:"POST",dataType:"json",success:function(a){0==a.result&&setTimeout(function(){$("#tag-pop").fadeOut(200),$(".js-tagpop-block").fadeOut(200),location=location},1e3)},error:function(a){$.prompt(a.msg,{icon:"question"})}})},recommendUser:function(){$.ajax({url:"/article/recommenduser",type:"post",dataType:"json",success:function(a){var c,g="",h="";if(0==a.result){if(c=a.data,!(c.length>0))return 0;g='<div class="clearfix"><h3 class="l">推荐作者</h3><div class="more r"><a href="/article/author" target="_blank">更多<i class="imv2-arrow2_r"></i></a></div></div><ul class="personList">',$.each(c,function(a,c){var v='style="display:none"';h=1==c.is_follows?'<button class="follow r moco-btn moco-btn-gray-l js-add-follow" data-uid='+c.uid+' data-type="1"'+v+'}><i class="imv2-add"></i>关注</button><button class="follow r moco-btn moco-btn-gray-l js-already-follow js-has-already" data-uid='+c.uid+' data-type="2"><i class="imv2-check"></i>已关注</button>':'<button class="follow r moco-btn moco-btn-gray-l js-add-follow" data-uid='+c.uid+' data-type="1" ><i class="imv2-add"></i>关注</button><button class="follow r moco-btn moco-btn-gray-l js-already-follow js-has-already" data-uid='+c.uid+' data-type="2"'+v+'><i class="imv2-check"></i>已关注</button>',g+='<li class="person clearfix"><a href="/u/'+c.uid+'" target="_blank" class="clearfix l"><div class="imgCon l"><img src="'+c.img+'" ></div><div class="text l"><div class="name js-usercard-dialog" data-userid="'+c.uid+'">'+c.nickname+'</div><p class="clearfix"><span class="l">'+c.article_num+'篇文章</span><span class="l">'+c.support_num+"个推荐</span></p></div></a>"+h+"</li>"}),g+="</ul>",$(".js-recommon-people").html(g),$(".js-has-already").hover(function(){$(this).html("取消关注")},function(){$(this).html('<i class="imv2-check"></i>已关注')})}}})},recommendArticle:function(){$.ajax({url:"/article/recommendarticle",type:"post",dataType:"json",success:function(a){var c,g="",h="";if(0==a.result){if(c=a.data,!(c.length>0))return 0;g='<div class="clearfix"><h3 class="l">热门文章</h3><div class="more r"><a href="/article/excellent?type=3" target="_blank">更多<i class="imv2-arrow2_r"></i></a></div></div><ul class="articleList">',$.each(c,function(a,c){h="",0==a&&(h='<p class="status top1"></p>'),1==a&&(h='<p class="status top2"></p>'),2==a&&(h='<p class="status top3"></p>'),g+='<li class="item clearfix"><div class="imgCon l"><img src="'+c.pic+'" >'+h+'</div><a href="/article/'+c.id+'" target="_blank"><div class="text r">'+c.title+"</div></a></li>"}),g+="</ul>",$(".js-hot_article").html(g)}}})},addFollow:function(a,g){var h={ok:{v:1101,_msg:"关注成功"},error:{v:1100,_msg:"关注失败"}},v={ok:{v:1201,_msg:"取消成功"},error:{v:1200,_msg:"取消失败"}};$.ajax({type:"post",url:a.url,dataType:"json",data:{uid:a.uid,type:a.type},success:function(a){a&&a.result&&(a.result==h.ok.v?g&&g():a.result==h.error.v?layer.msg(a.msg?a.msg:h.error._msg,1,1):a.result==v.ok.v?g&&g():a.result==v.error.v?layer.msg(a.msg?a.msg:v.error._msg,1,1):layer.msg(a.msg,1,1))},error:function(){layer.msg("网络错误，请稍后再试",1,1)},complete:function(){c=0}})},followIconClick:function(){var g=$(this),h=g.data("type"),v=g.data("uid"),b=g.siblings();c||(OP_CONFIG.userInfo?(c=1,1==h&&a.addFollow({url:"/u/"+OP_CONFIG.userInfo.uid+"/ajaxfollows",uid:v,type:1},function(){g.hide(),b.show(),usersInfoCache&&usersInfoCache[v]&&(usersInfoCache[v].is_follows=1)})):require.async("login_sns",function(a){a.init()}))},cancelFollowClick:function(){var c=$(this),g=c.data("uid"),h=c.siblings();a.addFollow({url:"/u/"+OP_CONFIG.userInfo.uid+"/ajaxfollows",uid:g,type:2},function(){c.hide(),h.show(),usersInfoCache&&usersInfoCache[g]&&(usersInfoCache[g].is_follows=0)})}},c=0,g=function(){$(document).on("click","#js-btn-note",function(){a.unLogin($(this))}).on("click",".js-switch",function(){a.changeSwitch($(this))}).on("click",".js-addtag",function(){a.openTagPop()}).on("click",".js-tagpop-close",function(){a.closeTagPop($(this))}).on("click",".tag-item li",function(){a.tabTagItem($(this))}).on("click",".tag-item-right li",function(){a.addTagList($(this))}).on("click",".js-remove-list",function(){a.removeTagList($(this))}).on("click",".js-sub-switch",function(){a.switchPop($(this))}).on("click",".tag-save-btn",function(){a.saveTagPop()}).on("click",".js-add-follow",a.followIconClick).on("click",".js-already-follow",a.cancelFollowClick)};g(),a.loadListUser(),a.recommendArticle(),a.recommendUser()});